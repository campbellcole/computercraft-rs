# computercraft-rs

A WebSocket layer for interacting with ComputerCraft from Rust. Currently only tested with [CC: Tweaked](https://tweaked.cc/) and [CraftOS-PC](https://www.craftos-pc.cc).

## Terminology

**CC**: An implementation of what is considered ComputerCraft (i.e. CC: Tweaked.) <br />
**Host**: The server hosting the websocket server and controlling the workers. <br />
**Worker**: A ComputerCraft computer running the `worker` program, connected to the Host.

## Notice

**This project is nowhere near completion. The fundamentals are in place, but there is a lot of work to be done.**

Here is a short summary of features that are not yet implemented:

- Documentation
- Error handling (`unwrap()` is used profusely in leu of proper error handling)
  - Most functions will panic if the Worker disconnects
- All wrapped peripherals besides `monitor`
- Access to CC globals (`disk`, `fs`, `os`, etc.)
- Execution of arbitrary Lua code
  - Calling Lua files that are on the Worker
  - Executing Lua code stored in or generated by the Host
- Named Workers

Some features which are implemented already:

- Connecting to one or more Workers over a websocket
- Two way serialization
- Lua error handling and serialization of errors
- True asynchronous communication using `Oneshot` channels
  - There is no possibility of two calls in rapid succession swapping return values with each other
- Attaching to un-wrapped peripherals
- Calling methods on peripherals using `peripheral.call`

## Purpose

It is not hard to have a CC program to dramatically drop the TPS on a server.
This library is intended to enable offloading expensive computations from the Minecraft server onto a separate process.

It is also useful for people who, like me, are not fond of Lua, and find maintaining a substantial Lua program to be discouraging, to say the least.

## Usage

### Host

```rs
use computercraft::Server;
use computercraft::peripheral::IntoWrappedPeripheral;
use computercraft::wrappers::monitor::Monitor;

let server = Server::listen();

let computer = server.wait_for_connection().await;

let peripheral = computer.find_peripheral("monitor_0").await.unwrap();

let monitor: Monitor = peripheral.into_wrapped().await.unwrap();

monitor.write("Hello from Rust!").await;
```

### Worker

Copy the `worker.lua` file and `worker/` directory to the Worker(s), and run `worker <hostname of server>`

Currently, the port is fixed to `56552`, so ensure that port is accessible through the hostname provided.

If you are running the Minecraft server and Host on the same computer, make sure you've
[configured local IP access](https://tweaked.cc/guide/local_ips.html).

**Note:** If you are intending on sending large objects over the WebSocket (i.e. `rsBridge.listItems()`), make sure you increase the `max_websocket_message` value accordingly.
